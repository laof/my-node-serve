<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>login</title>

</head>

<body>
  <div id="app">
    <p>username：<input type="text" v-model:value="username"></p>
    <p>password：<input type="password" v-model:value="password"></p>
    <a href="javascript:;" v-on:click="submit()">submit</a>
  </div>
  <script src="js/jquery3.2.1.js"></script>
  <script src="js/vue.js"></script>
  <script src="js/socket.io.js"></script>
  <!-- <script src="/socket.io/socket.io.js"></script> -->
  <!-- <script src="js/socket.io.js"></script>   -->
  <script>
    let vue = new Vue({
      el: '#app',
      data: {
        url: '/user/login',
        username: 'admin',
        password: 'adc123.com'
      },
      methods: {
        submit() {

          let param = {
            username: this.username,
            password: this.password,
          };

          let promise = new Promise((resolve, reject) => {
            $.ajax({
              url: this.url,
              type: 'post',
              data: param, success(data) {
                resolve(data);
              }, error(error) {
                reject(error);
              }
            })
          });

          promise.then(res => {
            this.color = 'green';
            location.reload();
            console.log('成功');
          }, error => {

            this.color = 'red';

          })

        }
      }
    })
    var webSocket = io.connect();
    //let webSocket = new WebSocket('ws://127.0.0.1:3130');
    // let webSocket = io.connect('http://localhost');

    webSocket.onopen = () => {
      console.log('链接成功');
      webSocket.send('I am lova');
    }
    webSocket.onmessage = (res) => {
      console.log(res);
    }
    webSocket.onclose = () => {
      console.log('oh .. kill webSocket');
    }

    webSocket.emit('message', { message: 21212 });

    webSocket.on("server not me", (e) => {
      console.log(e);
    });

    webSocket.on('server send', (e) => {
      console.log(e)
    })

    webSocket.emit('group1');


    setTimeout(() => {
      console.log(1111);
      webSocket.emit('login', { login: 'I am LaoK' });
    }, 2111)

  </script>
</body>

</html>